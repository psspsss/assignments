<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" width="1200" height="900">
  <defs>
    <!-- Gradients -->
    <linearGradient id="headerGrad2" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4a148c;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#6a1b9a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7b1fa2;stop-opacity:1" />
    </linearGradient>
    
    <radialGradient id="idleGrad" cx="50%" cy="50%" r="50%" fx="30%" fy="30%">
      <stop offset="0%" style="stop-color:#64b5f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1565c0;stop-opacity:1" />
    </radialGradient>
    
    <radialGradient id="inactiveGrad" cx="50%" cy="50%" r="50%" fx="30%" fy="30%">
      <stop offset="0%" style="stop-color:#ffb74d;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e65100;stop-opacity:1" />
    </radialGradient>
    
    <radialGradient id="connectedGrad" cx="50%" cy="50%" r="50%" fx="30%" fy="30%">
      <stop offset="0%" style="stop-color:#81c784;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2e7d32;stop-opacity:1" />
    </radialGradient>
    
    <linearGradient id="transitionGrad1" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1565c0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2e7d32;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="transitionGrad2" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#2e7d32;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e65100;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="transitionGrad3" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#e65100;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1565c0;stop-opacity:1" />
    </linearGradient>
    
    <!-- Shadow and Glow Effects -->
    <filter id="shadow2" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="4" dy="4" stdDeviation="5" flood-color="#000" flood-opacity="0.4"/>
    </filter>
    
    <filter id="innerGlow">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feComposite in="SourceGraphic" in2="blur" operator="over"/>
    </filter>
    
    <filter id="arrowGlow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <!-- Markers for arrows -->
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#1565c0"/>
    </marker>
    
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#2e7d32"/>
    </marker>
    
    <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#e65100"/>
    </marker>
    
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#c62828"/>
    </marker>
    
    <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#7b1fa2"/>
    </marker>
    
    <!-- Background Pattern -->
    <pattern id="hexPattern" width="50" height="43.4" patternUnits="userSpaceOnUse">
      <polygon points="25,0 50,12.5 50,37.5 25,50 0,37.5 0,12.5" fill="none" stroke="#e8eaf6" stroke-width="0.5"/>
    </pattern>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="900" fill="#fafafa"/>
  <rect width="1200" height="900" fill="url(#hexPattern)" opacity="0.5"/>
  
  <!-- Title Banner -->
  <rect x="0" y="0" width="1200" height="80" fill="url(#headerGrad2)"/>
  <text x="600" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="white">5G NR RRC State Machine &amp; Transitions</text>
  <text x="600" y="60" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#e1bee7">UE RRC States: IDLE | INACTIVE | CONNECTED (3GPP TS 38.331)</text>
  
  <!-- State Machine Diagram Area -->
  
  <!-- RRC_IDLE State -->
  <g filter="url(#shadow2)">
    <ellipse cx="200" cy="350" rx="130" ry="90" fill="url(#idleGrad)"/>
    <ellipse cx="200" cy="350" rx="120" ry="82" fill="none" stroke="white" stroke-width="2" stroke-dasharray="5,3"/>
  </g>
  <text x="200" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="white">RRC_IDLE</text>
  <text x="200" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#e3f2fd">No RRC Connection</text>
  <text x="200" y="375" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#bbdefb">Cell Reselection</text>
  <text x="200" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#bbdefb">DRX in Idle</text>
  
  <!-- RRC_INACTIVE State -->
  <g filter="url(#shadow2)">
    <ellipse cx="600" cy="200" rx="140" ry="95" fill="url(#inactiveGrad)"/>
    <ellipse cx="600" cy="200" rx="130" ry="87" fill="none" stroke="white" stroke-width="2" stroke-dasharray="5,3"/>
  </g>
  <text x="600" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="white">RRC_INACTIVE</text>
  <text x="600" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#fff3e0">UE Context Stored</text>
  <text x="600" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#ffe0b2">RNA-based Paging</text>
  <text x="600" y="240" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#ffe0b2">Fast Connection Resume</text>
  
  <!-- RRC_CONNECTED State -->
  <g filter="url(#shadow2)">
    <ellipse cx="600" cy="550" rx="150" ry="100" fill="url(#connectedGrad)"/>
    <ellipse cx="600" cy="550" rx="140" ry="92" fill="none" stroke="white" stroke-width="2" stroke-dasharray="5,3"/>
  </g>
  <text x="600" y="520" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="white">RRC_CONNECTED</text>
  <text x="600" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#e8f5e9">Active RRC Connection</text>
  <text x="600" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#c8e6c9">Data Transfer</text>
  <text x="600" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#c8e6c9">Handover Support</text>
  <text x="600" y="605" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#c8e6c9">Measurement Reporting</text>
  
  <!-- Transition Arrows and Labels -->
  
  <!-- IDLE to CONNECTED (RRC Setup) -->
  <path d="M 310 300 Q 400 350 470 480" fill="none" stroke="#2e7d32" stroke-width="4" marker-end="url(#arrowGreen)" filter="url(#arrowGlow)"/>
  <rect x="280" y="370" width="180" height="55" rx="8" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
  <text x="370" y="388" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1b5e20">RRC Setup Request</text>
  <text x="370" y="403" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">RRCSetupRequest</text>
  <text x="370" y="418" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">RRCSetup / RRCSetupComplete</text>
  
  <!-- CONNECTED to IDLE (RRC Release) -->
  <path d="M 470 600 Q 350 620 280 430" fill="none" stroke="#1565c0" stroke-width="4" marker-end="url(#arrowBlue)" filter="url(#arrowGlow)"/>
  <rect x="280" y="530" width="160" height="55" rx="8" fill="#e3f2fd" stroke="#1565c0" stroke-width="2"/>
  <text x="360" y="548" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#0d47a1">RRC Release</text>
  <text x="360" y="563" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">RRCRelease</text>
  <text x="360" y="578" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">(No suspend indication)</text>
  
  <!-- CONNECTED to INACTIVE (RRC Suspend) -->
  <path d="M 650 455 Q 750 350 700 290" fill="none" stroke="#e65100" stroke-width="4" marker-end="url(#arrowOrange)" filter="url(#arrowGlow)"/>
  <rect x="720" y="330" width="170" height="55" rx="8" fill="#fff3e0" stroke="#e65100" stroke-width="2"/>
  <text x="805" y="348" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">RRC Suspend</text>
  <text x="805" y="363" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#f57c00">RRCRelease with</text>
  <text x="805" y="378" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#f57c00">suspendConfig</text>
  
  <!-- INACTIVE to CONNECTED (RRC Resume) -->
  <path d="M 550 290 Q 480 380 500 455" fill="none" stroke="#2e7d32" stroke-width="4" marker-end="url(#arrowGreen)" filter="url(#arrowGlow)"/>
  <rect x="400" y="340" width="160" height="55" rx="8" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
  <text x="480" y="358" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1b5e20">RRC Resume</text>
  <text x="480" y="373" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">RRCResumeRequest</text>
  <text x="480" y="388" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">RRCResume / Complete</text>
  
  <!-- INACTIVE to IDLE (RRC Release/Timeout) -->
  <path d="M 470 230 Q 350 280 280 300" fill="none" stroke="#1565c0" stroke-width="4" marker-end="url(#arrowBlue)" filter="url(#arrowGlow)"/>
  <rect x="300" y="220" width="150" height="55" rx="8" fill="#e3f2fd" stroke="#1565c0" stroke-width="2"/>
  <text x="375" y="238" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#0d47a1">Connection Failure</text>
  <text x="375" y="253" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">T380 Expiry or</text>
  <text x="375" y="268" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">RRCRelease</text>
  
  <!-- IDLE to INACTIVE (via paging/notification) - not direct, shown as info -->
  <path d="M 310 290 Q 400 180 470 180" fill="none" stroke="#7b1fa2" stroke-width="3" stroke-dasharray="8,4" marker-end="url(#arrowPurple)"/>
  <rect x="340" y="140" width="130" height="45" rx="8" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="405" y="158" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#6a1b9a">RNA Update</text>
  <text x="405" y="173" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#7b1fa2">(Not direct transition)</text>
  
  <!-- Self-loops for states -->
  <!-- CONNECTED Handover -->
  <path d="M 750 530 Q 850 500 850 550 Q 850 600 750 570" fill="none" stroke="#43a047" stroke-width="3" marker-end="url(#arrowGreen)"/>
  <rect x="860" y="520" width="120" height="45" rx="6" fill="#c8e6c9" stroke="#43a047" stroke-width="1"/>
  <text x="920" y="538" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1b5e20">Handover</text>
  <text x="920" y="553" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#2e7d32">RRCReconfiguration</text>
  
  <!-- IDLE Cell Reselection -->
  <path d="M 90 320 Q 50 280 50 350 Q 50 420 90 380" fill="none" stroke="#1976d2" stroke-width="3" marker-end="url(#arrowBlue)"/>
  <rect x="20" y="420" width="100" height="40" rx="6" fill="#bbdefb" stroke="#1976d2" stroke-width="1"/>
  <text x="70" y="438" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#0d47a1">Cell</text>
  <text x="70" y="453" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#1565c0">Reselection</text>
  
  <!-- INACTIVE RNA-based mobility -->
  <path d="M 730 160 Q 800 100 800 180 Q 800 250 730 220" fill="none" stroke="#ef6c00" stroke-width="3" marker-end="url(#arrowOrange)"/>
  <rect x="810" y="150" width="100" height="40" rx="6" fill="#ffe0b2" stroke="#ef6c00" stroke-width="1"/>
  <text x="860" y="168" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#e65100">RNA-based</text>
  <text x="860" y="183" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#f57c00">Mobility</text>
  
  <!-- Legend and Details Box -->
  <rect x="50" y="680" width="1100" height="200" rx="10" fill="white" stroke="#9575cd" stroke-width="2" filter="url(#shadow2)"/>
  <text x="600" y="710" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#4a148c">RRC State Characteristics &amp; Key Procedures</text>
  
  <!-- Column 1: IDLE Details -->
  <g transform="translate(70, 725)">
    <ellipse cx="10" cy="8" rx="10" ry="8" fill="url(#idleGrad)"/>
    <text x="30" y="12" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#1565c0">RRC_IDLE</text>
    <text x="30" y="30" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• No AS context in gNB</text>
    <text x="30" y="45" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• CN-based paging</text>
    <text x="30" y="60" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• PLMN selection</text>
    <text x="30" y="75" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• Cell selection/reselection</text>
    <text x="30" y="90" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• DRX configured by SIB</text>
    <text x="30" y="105" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• Minimum UE power</text>
  </g>
  
  <!-- Column 2: INACTIVE Details -->
  <g transform="translate(400, 725)">
    <ellipse cx="10" cy="8" rx="10" ry="8" fill="url(#inactiveGrad)"/>
    <text x="30" y="12" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#e65100">RRC_INACTIVE</text>
    <text x="30" y="30" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• AS context in gNB &amp; CN</text>
    <text x="30" y="45" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• RAN-based paging (RNA)</text>
    <text x="30" y="60" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• Fast resume procedure</text>
    <text x="30" y="75" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• RNA update on mobility</text>
    <text x="30" y="90" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• RAN-configured DRX</text>
    <text x="30" y="105" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• I-RNTI for identification</text>
  </g>
  
  <!-- Column 3: CONNECTED Details -->
  <g transform="translate(730, 725)">
    <ellipse cx="10" cy="8" rx="10" ry="8" fill="url(#connectedGrad)"/>
    <text x="30" y="12" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#2e7d32">RRC_CONNECTED</text>
    <text x="30" y="30" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• Full AS context active</text>
    <text x="30" y="45" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• Unicast data transfer</text>
    <text x="30" y="60" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• Network-controlled mobility</text>
    <text x="30" y="75" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• Measurement reporting</text>
    <text x="30" y="90" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• Connected mode DRX</text>
    <text x="30" y="105" font-family="Arial, sans-serif" font-size="11" fill="#37474f">• C-RNTI for identification</text>
  </g>
  
  <!-- Timers Box -->
  <rect x="950" y="720" width="180" height="130" rx="6" fill="#ede7f6" stroke="#7b1fa2" stroke-width="1"/>
  <text x="1040" y="740" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#4a148c">Key Timers</text>
  <text x="960" y="760" font-family="Arial, sans-serif" font-size="10" fill="#37474f">T300: RRC Setup</text>
  <text x="960" y="775" font-family="Arial, sans-serif" font-size="10" fill="#37474f">T301: RRC Reestablishment</text>
  <text x="960" y="790" font-family="Arial, sans-serif" font-size="10" fill="#37474f">T304: Handover</text>
  <text x="960" y="805" font-family="Arial, sans-serif" font-size="10" fill="#37474f">T310: Radio Link Failure</text>
  <text x="960" y="820" font-family="Arial, sans-serif" font-size="10" fill="#37474f">T311: RLF Recovery</text>
  <text x="960" y="835" font-family="Arial, sans-serif" font-size="10" fill="#37474f">T380: Inactive Timer</text>
  
  <!-- Footer -->
  <text x="600" y="890" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#78909c">© CafeTele Telecom Training | www.cafetele.com | 5G NR RRC State Machine Diagram</text>
</svg>
