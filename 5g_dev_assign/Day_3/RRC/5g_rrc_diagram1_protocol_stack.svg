<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" width="1200" height="900">
  <defs>
    <!-- Gradient Definitions -->
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1a237e;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#0d47a1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#01579b;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="ueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4fc3f7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0288d1;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="gnbGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#81c784;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#388e3c;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="amfGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ffb74d;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f57c00;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="rrcGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e57373;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c62828;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="pdcpGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ba68c8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7b1fa2;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="rlcGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4db6ac;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#00796b;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="macGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ffd54f;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ff8f00;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="phyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#90a4ae;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#455a64;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="nasGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f48fb1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c2185b;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="ngapGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#a5d6a7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2e7d32;stop-opacity:1" />
    </linearGradient>
    
    <!-- Shadow Filter -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="4" flood-color="#000" flood-opacity="0.3"/>
    </filter>
    
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <!-- Pattern for background -->
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e3f2fd" stroke-width="0.5"/>
    </pattern>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="900" fill="#f5f7fa"/>
  <rect width="1200" height="900" fill="url(#grid)"/>
  
  <!-- Title Banner -->
  <rect x="0" y="0" width="1200" height="80" fill="url(#headerGrad)"/>
  <text x="600" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="white">5G NR RRC Protocol Stack Architecture</text>
  <text x="600" y="60" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#b3e5fc">3GPP TS 38.331 - Radio Resource Control (RRC) Protocol Specification</text>
  
  <!-- Network Element Labels -->
  <text x="200" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1565c0">UE</text>
  <text x="200" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#546e7a">(User Equipment)</text>
  
  <text x="600" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#2e7d32">gNB</text>
  <text x="600" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#546e7a">(Next Generation NodeB)</text>
  
  <text x="1000" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#e65100">AMF</text>
  <text x="1000" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#546e7a">(Access and Mobility Function)</text>
  
  <!-- UE Protocol Stack -->
  <g filter="url(#shadow)">
    <!-- NAS Layer -->
    <rect x="50" y="170" width="300" height="60" rx="8" fill="url(#nasGrad)"/>
    <text x="200" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">NAS</text>
    <text x="200" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Non-Access Stratum</text>
    
    <!-- RRC Layer -->
    <rect x="50" y="240" width="300" height="80" rx="8" fill="url(#rrcGrad)"/>
    <text x="200" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="white">RRC</text>
    <text x="200" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Radio Resource Control</text>
    <text x="200" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#ffcdd2">SRB0, SRB1, SRB2, SRB3</text>
    
    <!-- PDCP Layer -->
    <rect x="50" y="330" width="300" height="60" rx="8" fill="url(#pdcpGrad)"/>
    <text x="200" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">PDCP</text>
    <text x="200" y="375" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Packet Data Convergence Protocol</text>
    
    <!-- RLC Layer -->
    <rect x="50" y="400" width="300" height="60" rx="8" fill="url(#rlcGrad)"/>
    <text x="200" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">RLC</text>
    <text x="200" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Radio Link Control</text>
    
    <!-- MAC Layer -->
    <rect x="50" y="470" width="300" height="60" rx="8" fill="url(#macGrad)"/>
    <text x="200" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">MAC</text>
    <text x="200" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#5d4037">Medium Access Control</text>
    
    <!-- PHY Layer -->
    <rect x="50" y="540" width="300" height="60" rx="8" fill="url(#phyGrad)"/>
    <text x="200" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">PHY</text>
    <text x="200" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Physical Layer</text>
  </g>
  
  <!-- gNB Protocol Stack -->
  <g filter="url(#shadow)">
    <!-- NGAP Layer -->
    <rect x="450" y="170" width="300" height="60" rx="8" fill="url(#ngapGrad)"/>
    <text x="600" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">NGAP</text>
    <text x="600" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">NG Application Protocol</text>
    
    <!-- RRC Layer -->
    <rect x="450" y="240" width="300" height="80" rx="8" fill="url(#rrcGrad)"/>
    <text x="600" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="white">RRC</text>
    <text x="600" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Radio Resource Control</text>
    <text x="600" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#ffcdd2">Connection Management</text>
    
    <!-- PDCP Layer -->
    <rect x="450" y="330" width="300" height="60" rx="8" fill="url(#pdcpGrad)"/>
    <text x="600" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">PDCP</text>
    <text x="600" y="375" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Ciphering &amp; Integrity Protection</text>
    
    <!-- RLC Layer -->
    <rect x="450" y="400" width="300" height="60" rx="8" fill="url(#rlcGrad)"/>
    <text x="600" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">RLC</text>
    <text x="600" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">ARQ &amp; Segmentation</text>
    
    <!-- MAC Layer -->
    <rect x="450" y="470" width="300" height="60" rx="8" fill="url(#macGrad)"/>
    <text x="600" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">MAC</text>
    <text x="600" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#5d4037">Scheduling &amp; HARQ</text>
    
    <!-- PHY Layer -->
    <rect x="450" y="540" width="300" height="60" rx="8" fill="url(#phyGrad)"/>
    <text x="600" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">PHY</text>
    <text x="600" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Physical Layer (Uu Interface)</text>
  </g>
  
  <!-- AMF Protocol Stack -->
  <g filter="url(#shadow)">
    <!-- NAS Layer -->
    <rect x="850" y="170" width="300" height="60" rx="8" fill="url(#nasGrad)"/>
    <text x="1000" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">NAS</text>
    <text x="1000" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">5GMM / 5GSM</text>
    
    <!-- NGAP Layer -->
    <rect x="850" y="240" width="300" height="60" rx="8" fill="url(#ngapGrad)"/>
    <text x="1000" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">NGAP</text>
    <text x="1000" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">NG Application Protocol</text>
    
    <!-- SCTP Layer -->
    <rect x="850" y="310" width="300" height="50" rx="8" fill="#78909c"/>
    <text x="1000" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">SCTP</text>
    
    <!-- IP Layer -->
    <rect x="850" y="370" width="300" height="50" rx="8" fill="#607d8b"/>
    <text x="1000" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">IP</text>
    
    <!-- L2 Layer -->
    <rect x="850" y="430" width="300" height="50" rx="8" fill="#546e7a"/>
    <text x="1000" y="460" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">L2 (Data Link)</text>
    
    <!-- L1 Layer -->
    <rect x="850" y="490" width="300" height="50" rx="8" fill="#455a64"/>
    <text x="1000" y="520" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">L1 (Physical)</text>
  </g>
  
  <!-- Interface Labels and Arrows -->
  <!-- Uu Interface -->
  <line x1="355" y1="570" x2="445" y2="570" stroke="#1565c0" stroke-width="4" stroke-dasharray="8,4"/>
  <polygon points="445,570 435,565 435,575" fill="#1565c0"/>
  <polygon points="355,570 365,565 365,575" fill="#1565c0"/>
  <rect x="375" y="610" width="50" height="25" rx="5" fill="#1565c0"/>
  <text x="400" y="627" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Uu</text>
  
  <!-- NG Interface -->
  <line x1="755" y1="280" x2="845" y2="280" stroke="#2e7d32" stroke-width="4" stroke-dasharray="8,4"/>
  <polygon points="845,280 835,275 835,285" fill="#2e7d32"/>
  <polygon points="755,280 765,275 765,285" fill="#2e7d32"/>
  <rect x="775" y="250" width="50" height="25" rx="5" fill="#2e7d32"/>
  <text x="800" y="267" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">NG</text>
  
  <!-- RRC Connection Arrow -->
  <path d="M 200 240 Q 200 160 600 160 Q 600 160 600 240" fill="none" stroke="#c62828" stroke-width="3" stroke-dasharray="5,3" filter="url(#glow)"/>
  <text x="400" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c62828">RRC Connection (Control Plane)</text>
  
  <!-- NAS Connection Arrow -->
  <path d="M 200 170 Q 200 100 1000 100 Q 1000 100 1000 170" fill="none" stroke="#c2185b" stroke-width="3" stroke-dasharray="5,3"/>
  <text x="600" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c2185b">NAS Signaling (End-to-End)</text>
  
  <!-- Legend Box -->
  <rect x="50" y="660" width="1100" height="220" rx="10" fill="white" stroke="#cfd8dc" stroke-width="2" filter="url(#shadow)"/>
  <text x="600" y="690" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1a237e">RRC Protocol Key Functions &amp; Characteristics</text>
  
  <!-- Legend Content - Column 1 -->
  <g transform="translate(70, 710)">
    <rect x="0" y="0" width="15" height="15" rx="3" fill="url(#rrcGrad)"/>
    <text x="25" y="12" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">RRC Functions:</text>
    <text x="25" y="30" font-family="Arial, sans-serif" font-size="11" fill="#555">• System Information Broadcasting (SIB1-SIB9)</text>
    <text x="25" y="46" font-family="Arial, sans-serif" font-size="11" fill="#555">• Paging for Idle Mode UEs</text>
    <text x="25" y="62" font-family="Arial, sans-serif" font-size="11" fill="#555">• RRC Connection Management</text>
    <text x="25" y="78" font-family="Arial, sans-serif" font-size="11" fill="#555">• Radio Bearer Configuration</text>
    <text x="25" y="94" font-family="Arial, sans-serif" font-size="11" fill="#555">• Mobility Management (Handover)</text>
    <text x="25" y="110" font-family="Arial, sans-serif" font-size="11" fill="#555">• Measurement Configuration &amp; Reporting</text>
    <text x="25" y="126" font-family="Arial, sans-serif" font-size="11" fill="#555">• Security Activation</text>
  </g>
  
  <!-- Legend Content - Column 2 -->
  <g transform="translate(400, 710)">
    <rect x="0" y="0" width="15" height="15" rx="3" fill="#1565c0"/>
    <text x="25" y="12" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">RRC States (5G NR):</text>
    <text x="25" y="30" font-family="Arial, sans-serif" font-size="11" fill="#555">• RRC_IDLE: No RRC connection, cell reselection</text>
    <text x="25" y="46" font-family="Arial, sans-serif" font-size="11" fill="#555">• RRC_INACTIVE: UE context in gNB/CN</text>
    <text x="25" y="62" font-family="Arial, sans-serif" font-size="11" fill="#555">• RRC_CONNECTED: Active connection</text>
    <text x="25" y="90" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Signaling Radio Bearers:</text>
    <text x="25" y="108" font-family="Arial, sans-serif" font-size="11" fill="#555">• SRB0: CCCH (RRC messages before security)</text>
    <text x="25" y="124" font-family="Arial, sans-serif" font-size="11" fill="#555">• SRB1: DCCH (RRC + piggybacked NAS)</text>
    <text x="25" y="140" font-family="Arial, sans-serif" font-size="11" fill="#555">• SRB2: DCCH (NAS messages only)</text>
    <text x="25" y="156" font-family="Arial, sans-serif" font-size="11" fill="#555">• SRB3: For MR-DC (Split SRB)</text>
  </g>
  
  <!-- Legend Content - Column 3 -->
  <g transform="translate(800, 710)">
    <rect x="0" y="0" width="15" height="15" rx="3" fill="#2e7d32"/>
    <text x="25" y="12" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Key Interfaces:</text>
    <text x="25" y="30" font-family="Arial, sans-serif" font-size="11" fill="#555">• Uu: Air interface (UE ↔ gNB)</text>
    <text x="25" y="46" font-family="Arial, sans-serif" font-size="11" fill="#555">• NG-C: Control plane (gNB ↔ AMF)</text>
    <text x="25" y="62" font-family="Arial, sans-serif" font-size="11" fill="#555">• Xn: Inter-gNB interface</text>
    <text x="25" y="90" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">3GPP Specifications:</text>
    <text x="25" y="108" font-family="Arial, sans-serif" font-size="11" fill="#555">• TS 38.331: RRC Protocol</text>
    <text x="25" y="124" font-family="Arial, sans-serif" font-size="11" fill="#555">• TS 38.300: NR Architecture</text>
    <text x="25" y="140" font-family="Arial, sans-serif" font-size="11" fill="#555">• TS 38.321: MAC Protocol</text>
    <text x="25" y="156" font-family="Arial, sans-serif" font-size="11" fill="#555">• TS 38.323: PDCP Protocol</text>
  </g>
  
  <!-- Footer -->
  <text x="600" y="890" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#78909c">© CafeTele Telecom Training | www.cafetele.com | 5G NR RRC Protocol Architecture Diagram</text>
</svg>
