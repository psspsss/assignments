<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NRF in 5G Core Architecture | Interactive Textbook</title>
    <!-- GSAP for technical animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
    <style>
        :root {
            /* Everforest Light Palette */
            --bg0: #fdf6e3;
            --bg1: #f3efda;
            --bg2: #e0dcc7;
            --fg: #5c6a72;
            --red: #f85552;
            --orange: #f57d26;
            --yellow: #dfa000;
            --green: #8da101;
            --aqua: #35a77c;
            --blue: #3a94c5;
            --purple: #df69ba;
            --nrf-green: #10a37f;

            --shadow: 0 10px 30px rgba(0,0,0,0.06);
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg0);
            color: var(--fg);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 1.5rem;
            text-align: center;
            background: white;
            border-bottom: 2px solid var(--bg1);
            z-index: 10;
        }

        header h1 { font-size: 1.8rem; color: #2d353b; margin-bottom: 0.2rem; }
        header p { font-size: 0.95rem; color: var(--fg); opacity: 0.8; }

        /* Simulation Sidebar */
        .controls {
            position: absolute;
            top: 100px;
            right: 25px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 50;
        }

        .btn {
            background: white;
            border: 1px solid var(--bg2);
            padding: 12px 18px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: var(--fg);
            transition: var(--transition);
            box-shadow: 0 3px 6px rgba(0,0,0,0.04);
            text-align: left;
            font-size: 0.85rem;
        }
        .btn:hover { background: var(--nrf-green); color: white; border-color: var(--nrf-green); transform: translateX(-5px); }

        main {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        svg {
            width: 100%;
            height: 100%;
            max-width: 1100px;
            max-height: 750px;
        }

        /* Node Styling */
        .node { cursor: pointer; transition: transform 0.3s ease; }
        .node:hover { transform: scale(1.03); }

        /* Detail Panel */
        #side-panel {
            position: fixed;
            right: -450px;
            top: 0;
            width: 420px;
            height: 100%;
            background: white;
            box-shadow: -15px 0 45px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 60px 40px;
            transition: right 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            border-left: 8px solid var(--nrf-green);
        }

        #side-panel.active { right: 0; }

        .close-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 1.6rem;
            cursor: pointer;
            color: var(--fg);
        }

        .panel-tag { font-size: 0.75rem; font-weight: 900; text-transform: uppercase; color: var(--bg2); letter-spacing: 1.5px; }
        .panel-title { font-size: 1.8rem; color: var(--nrf-green); margin: 10px 0 20px; line-height: 1.2; }
        .panel-content { line-height: 1.8; font-size: 1.05rem; color: var(--fg); text-align: justify; }

        /* Signature - IMPORTANT */
        .signature {
            position: absolute;
            bottom: 25px;
            left: 25px;
            font-family: 'Georgia', serif;
            font-style: italic;
            font-size: 1.2rem;
            color: var(--fg);
            opacity: 0.7;
            pointer-events: none;
            border-bottom: 1px solid var(--fg);
        }

        /* Flow Particles */
        .particle { visibility: hidden; pointer-events: none; }

        #toast {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #2d353b;
            color: white;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 0.9rem;
            opacity: 0;
            z-index: 200;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <header>
        <h1>NRF in 5G Core Architecture</h1>
        <p>Central registry position in the Service-Based Architecture</p>
    </header>

    <div class="controls">
        <button class="btn" onclick="animateFlow('registration')">Simulation: NF Registration</button>
        <button class="btn" onclick="animateFlow('discovery')">Simulation: NF Discovery</button>
        <button class="btn" style="border-color:var(--red); color:var(--red)" onclick="resetSystem()">Reset System</button>
    </div>

    <main>
        <svg id="nrf-svg" viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
            <!-- Background Spoke Connections -->
            <g stroke="#10a37f" stroke-width="2" opacity="0.6">
                <path id="path-amf" d="M 210 220 L 410 320" />
                <path id="path-udm" d="M 500 180 L 500 280" />
                <path id="path-smf" d="M 790 220 L 590 320" />
                <path id="path-ausf" d="M 210 500 L 410 400" />
                <path id="path-pcf" d="M 500 520 L 500 420" />
                <path id="path-nssf" d="M 790 500 L 590 400" />
            </g>

            <!-- Radial Background Circles -->
            <circle cx="500" cy="350" r="130" fill="none" stroke="#10a37f" stroke-width="0.5" opacity="0.1" />
            <circle cx="500" cy="350" r="160" fill="none" stroke="#10a37f" stroke-width="0.5" opacity="0.05" />

            <!-- Flow Particles -->
            <circle id="p-reg" class="particle" r="6" fill="var(--nrf-green)" />
            <circle id="p-query" class="particle" r="6" fill="var(--blue)" />

            <!-- NODES -->
            <!-- AMF (Access Mgmt) -->
            <g class="node" onclick="openNode('amf')">
                <rect x="110" y="170" width="100" height="80" rx="12" fill="#0d47a1" />
                <text x="160" y="205" text-anchor="middle" fill="white" font-weight="bold" font-size="14">AMF</text>
                <text x="160" y="225" text-anchor="middle" fill="white" font-size="9" opacity="0.8">Access Mgmt</text>
            </g>

            <!-- UDM (Data Mgmt) -->
            <g class="node" onclick="openNode('udm')">
                <rect x="450" y="100" width="100" height="80" rx="12" fill="#d81b60" />
                <text x="500" y="135" text-anchor="middle" fill="white" font-weight="bold" font-size="14">UDM</text>
                <text x="500" y="155" text-anchor="middle" fill="white" font-size="9" opacity="0.8">Data Mgmt</text>
            </g>

            <!-- SMF (Session Mgmt) -->
            <g class="node" onclick="openNode('smf')">
                <rect x="790" y="170" width="100" height="80" rx="12" fill="#7c4dff" />
                <text x="840" y="205" text-anchor="middle" fill="white" font-weight="bold" font-size="14">SMF</text>
                <text x="840" y="225" text-anchor="middle" fill="white" font-size="9" opacity="0.8">Session Mgmt</text>
            </g>

            <!-- AUSF (Auth Server) -->
            <g class="node" onclick="openNode('ausf')">
                <rect x="110" y="450" width="100" height="80" rx="12" fill="#536dfe" />
                <text x="160" y="485" text-anchor="middle" fill="white" font-weight="bold" font-size="14">AUSF</text>
                <text x="160" y="505" text-anchor="middle" fill="white" font-size="9" opacity="0.8">Auth Server</text>
            </g>

            <!-- PCF (Policy Control) -->
            <g class="node" onclick="openNode('pcf')">
                <rect x="450" y="520" width="100" height="80" rx="12" fill="#fb8c00" />
                <text x="500" y="555" text-anchor="middle" fill="white" font-weight="bold" font-size="14">PCF</text>
                <text x="500" y="575" text-anchor="middle" fill="white" font-size="9" opacity="0.8">Policy Control</text>
            </g>

            <!-- NSSF (Slice Select) -->
            <g class="node" onclick="openNode('nssf')">
                <rect x="790" y="450" width="100" height="80" rx="12" fill="#00bfa5" />
                <text x="840" y="485" text-anchor="middle" fill="white" font-weight="bold" font-size="14">NSSF</text>
                <text x="840" y="505" text-anchor="middle" fill="white" font-size="9" opacity="0.8">Slice Select</text>
            </g>

            <!-- NRF (Central Circle) -->
            <g class="node" onclick="openNode('nrf')">
                <circle id="nrf-center" cx="500" cy="350" r="80" fill="#10a37f" stroke="white" stroke-width="2" />
                <text x="500" y="340" text-anchor="middle" fill="white" font-weight="bold" font-size="22">NRF</text>
                <text x="500" y="365" text-anchor="middle" fill="white" font-size="11">Service Registry</text>
                <text x="500" y="385" text-anchor="middle" fill="#ffeb3b" font-weight="bold" font-size="9">⚡ Central Hub ⚡</text>
            </g>
        </svg>

        <div id="toast">Ready for simulation</div>
        <div class="signature">Vinayak Majhi</div>
    </main>

    <div id="side-panel">
        <div class="close-btn" onclick="closePanel()">✕</div>
        <div class="panel-header">
            <span id="p-tag" class="panel-tag">CORE NETWORK FUNCTION</span>
            <h2 id="p-title" class="panel-title">Component Name</h2>
        </div>
        <div id="p-body" class="panel-content">
            Detailed explanation will populate here...
        </div>
    </div>

    <script>
        gsap.registerPlugin(MotionPathPlugin);

        const techContent = {
            nrf: {
                title: "Network Repository Function (NRF)",
                body: "The Network Repository Function (NRF) is the absolute heart of the 5G Service-Based Architecture (SBA). It acts as a dynamic central directory for all active Network Function (NF) instances within the 5G Core. When any NF (like an AMF or SMF) powers on, it registers its profile, IP address, and supported services with the NRF. This allows for a 'decoupled' discovery mechanism: instead of hardcoding addresses, NFs simply query the NRF to find peers that support specific services. This architecture is vital for the cloud-native scalability of 5G, as it allows network functions to be created and destroyed dynamically while maintaining a live map of the entire core system."
            },
            amf: {
                title: "Access & Mobility Mgmt (AMF)",
                body: "The AMF is the primary consumer of the NRF's discovery services. As the gateway for User Equipment (UE), the AMF must constantly interact with other core components. For instance, when a UE requests a new data session, the AMF doesn't inherently know which SMF to use. It queries the NRF to 'Discover' an available Session Management Function that matches the UE's location and requested network slice. Once the NRF provides a list of suitable SMF profiles, the AMF can then establish the necessary control-plane signaling. Without the NRF, the AMF would be unable to adapt to the distributed, multi-vendor environment of a modern 5G network."
            },
            udm: {
                title: "Unified Data Management (UDM)",
                body: "The UDM registers its service endpoints with the NRF so that other network functions can find it to retrieve subscriber data. When an AMF needs to authenticate a user, it first discovers the correct UDM instance through an NRF query. The NRF maintains information about which UDM instances serve which subscriber groups. By providing this 'Registry' service, the NRF ensures that subscription management remains centralized yet discoverable, allowing the 5G core to scale its data management layer independently from the signaling layer."
            },
            smf: {
                title: "Session Management (SMF)",
                body: "The SMF is a 'Producer' in the NRF ecosystem. Upon startup, every SMF instance performs an 'NF Registration' with the NRF, listing its capabilities—such as the Network Slices (NSSAIs) and Data Network Names (DNNs) it can handle. When load changes or an SMF instance fails, the NRF updates its records. This allows the core network to implement efficient load balancing and fault tolerance; the AMF will only discover healthy, active SMF instances through the NRF. This registration-discovery cycle is what enables the 'Elasticity' of 5G session management."
            },
            ausf: {
                title: "Authentication Server (AUSF)",
                body: "The AUSF relies on the NRF to be visible to the AMF during the initial registration of a device. Because security is paramount, the NRF ensures that only legitimate, authorized network functions are registered in the core. When the AMF needs to verify a UE's identity, it performs a discovery query to the NRF for an AUSF service producer. The NRF then returns the endpoint details for the security function, facilitating a secure and automated authentication handshake without manual configuration."
            },
            pcf: {
                title: "Policy Control Function (PCF)",
                body: "The PCF registers its policy-provisioning services with the NRF. This is critical because policy rules (like QoS and bitrates) must be applied across both access (AMF) and session (SMF) contexts. By querying the NRF, the SMF can find the appropriate PCF that holds the specific policy rules for a user's current session. The NRF acts as the broker that connects policy decision-makers with policy enforcers, ensuring that the complex logic of 5G data management is applied consistently across a distributed NF pool."
            },
            nssf: {
                title: "Slice Selection (NSSF)",
                body: "The NSSF uses the NRF to determine which specific slice instances are currently available and healthy. Network Slicing is a core 5G feature, and the NSSF is tasked with choosing the right slice for a user. To do this, the NSSF queries the NRF to get the list of NF instances (like AMFs and SMFs) that belong to a specific Network Slice Instance (NSI). This ensures that a user requesting a high-bandwidth slice is actually routed to the network resources optimized for that specific use case, making the NRF the source of availability data for slicing logic."
            }
        };

        function openNode(key) {
            const data = techContent[key];
            if(!data) return;
            document.getElementById('p-tag').innerText = key === 'nrf' ? "CENTRAL HUB" : "SERVICE CONSUMER/PRODUCER";
            document.getElementById('p-title').innerText = data.title;
            document.getElementById('p-body').innerText = data.body;
            document.getElementById('side-panel').classList.add('active');
            
            gsap.to('.node', { opacity: 0.3, duration: 0.4 });
            // Logic to highlight specifically the clicked one if needed
        }

        function closePanel() {
            document.getElementById('side-panel').classList.remove('active');
            gsap.to('.node', { opacity: 1, duration: 0.4 });
        }

        // --- Animation Engine ---
        let tl = gsap.timeline();

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            gsap.to(t, { opacity: 1, y: -10, duration: 0.3 });
            setTimeout(() => gsap.to(t, { opacity: 0, duration: 0.3 }), 2500);
        }

        function resetSystem() {
            tl.kill();
            gsap.set(".particle", { visibility: "hidden", x: 0, y: 0, opacity: 1 });
            showToast("System Reset Successful");
        }

        function animateFlow(type) {
            resetSystem();
            tl = gsap.timeline();

            if (type === 'registration') {
                showToast("Starting NF Registration: SMF sending profile...");
                tl.to("#p-reg", { visibility: "visible", duration: 0 })
                  .to("#p-reg", { motionPath: { path: "#path-smf", align: "#path-smf", alignOrigin: [0.5, 0.5] }, duration: 1.5, ease: "power1.inOut", start: 0, end: 1 })
                  .to("#nrf-center", { scale: 1.1, stroke: "var(--yellow)", duration: 0.3, repeat: 1, yoyo: true })
                  .call(() => showToast("Registration Complete: NRF Registry Updated."));
            } 
            else if (type === 'discovery') {
                showToast("Starting NF Discovery: AMF querying registry...");
                tl.to("#p-query", { visibility: "visible", duration: 0 })
                  .to("#p-query", { motionPath: { path: "#path-amf", align: "#path-amf", alignOrigin: [0.5, 0.5] }, duration: 1.5, ease: "power1.inOut" })
                  .to("#nrf-center", { fill: "#158e6e", duration: 0.4 })
                  .call(() => showToast("NRF search successful. Returning SMF address..."))
                  .to("#p-query", { motionPath: { path: "#path-amf", align: "#path-amf", alignOrigin: [0.5, 0.5] }, duration: 1.2, ease: "power1.out", start: 1, end: 0 })
                  .to("#nrf-center", { fill: "#10a37f", duration: 0.4 });
            }
        }

        // Ambient heartbeat for NRF center
        gsap.to("#nrf-center", {
            r: 85,
            duration: 2,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut"
        });

    </script>
</body>
</html>