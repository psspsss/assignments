<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3GPP 5G PCF Architecture | Interactive Policy Guide</title>
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
    <style>
        :root {
            /* Everforest Light Palette */
            --bg0: #fdf6e3;
            --bg1: #f3efda;
            --bg2: #e0dcc7;
            --fg: #5c6a72;
            --red: #f85552;
            --orange: #f57d26;
            --yellow: #dfa000;
            --green: #8da101;
            --aqua: #35a77c;
            --blue: #3a94c5;
            --purple: #df69ba;
            --dark-purple: #9b59b6;

            --font-main: 'Segoe UI', system-ui, -apple-system, sans-serif;
            --transition: all 0.5s cubic-bezier(0.2, 1, 0.3, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg0);
            color: var(--fg);
            font-family: var(--font-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 1.5rem 3rem;
            background: white;
            border-bottom: 2px solid var(--bg1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.02);
        }

        .header-left h1 { font-size: 1.6rem; color: #2d353b; letter-spacing: -0.5px; }
        .header-left p { font-size: 0.9rem; opacity: 0.7; }

        .controls { display: flex; gap: 12px; }

        .btn {
            background: var(--bg1);
            border: 1px solid var(--bg2);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--fg);
            transition: var(--transition);
        }
        .btn:hover { background: var(--aqua); color: white; transform: translateY(-2px); border-color: var(--aqua); }

        main {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        #pcf-svg {
            width: 100%;
            height: 100%;
            max-width: 1200px;
            max-height: 850px;
        }

        /* Node Interactivity */
        .node { cursor: pointer; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .node:hover { transform: scale(1.02); }

        /* Side Panel */
        #side-panel {
            position: fixed;
            right: -450px;
            top: 0;
            width: 420px;
            height: 100%;
            background: white;
            box-shadow: -15px 0 50px rgba(0,0,0,0.12);
            z-index: 1000;
            padding: 60px 40px;
            transition: right 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            border-left: 8px solid var(--aqua);
            overflow-y: auto;
        }
        #side-panel.active { right: 0; }

        .close-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 1.6rem;
            cursor: pointer;
            color: var(--fg);
        }

        .panel-tag { font-size: 0.75rem; font-weight: 900; text-transform: uppercase; color: var(--bg2); letter-spacing: 2px; margin-bottom: 8px; display: block; }
        .panel-title { font-size: 2rem; color: var(--aqua); margin-bottom: 25px; line-height: 1.1; font-weight: 700; }
        .panel-content { line-height: 1.8; font-size: 1.05rem; color: var(--fg); text-align: justify; }

        /* Signature */
        .signature {
            position: absolute;
            bottom: 30px;
            left: 30px;
            font-family: 'Georgia', serif;
            font-style: italic;
            font-size: 1.4rem;
            color: var(--fg);
            opacity: 0.8;
            border-bottom: 2px solid var(--aqua);
            pointer-events: none;
        }

        #toast {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #2d353b;
            color: white;
            padding: 12px 35px;
            border-radius: 50px;
            opacity: 0;
            z-index: 200;
            font-weight: 600;
            pointer-events: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .particle { visibility: hidden; pointer-events: none; }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <h1>Policy Control Function (PCF) Architecture</h1>
            <p>3GPP TS 23.501 | TS 23.503 Policy and Charging Control Framework</p>
        </div>
        <div class="controls">
            <button class="btn" onclick="animatePCF('pcc')">PCC Rule Provision (N7)</button>
            <button class="btn" onclick="animatePCF('mobility')">Mobility Policy (N15)</button>
            <button class="btn" onclick="animatePCF('influence')">App Influence (N5)</button>
            <button class="btn" style="border-color:var(--red); color:var(--red)" onclick="resetPCF()">Reset</button>
        </div>
    </header>

    <div id="toast">Initializing Policy Engine...</div>

    <main>
        <svg id="pcf-svg" viewBox="0 0 1200 850" xmlns="http://www.w3.org/2000/svg">
            <!-- Connection Paths -->
            <path id="path-n7" d="M 180 250 L 500 425" stroke="var(--blue)" stroke-width="2" stroke-dasharray="10,5" fill="none" opacity="0.4"/>
            <path id="path-n15" d="M 180 425 L 500 425" stroke="var(--green)" stroke-width="2" stroke-dasharray="10,5" fill="none" opacity="0.4"/>
            <path id="path-n5" d="M 180 600 L 500 425" stroke="var(--purple)" stroke-width="2" stroke-dasharray="10,5" fill="none" opacity="0.4"/>
            
            <path id="path-nudr" d="M 700 425 L 980 425" stroke="var(--orange)" stroke-width="4" fill="none" opacity="0.4"/>
            <path id="path-n28" d="M 600 575 L 600 700" stroke="var(--red)" stroke-width="3" stroke-dasharray="8,4" fill="none" opacity="0.3"/>

            <!-- THE PCF CORE CONTAINER -->
            <rect x="500" y="300" width="200" height="250" rx="30" fill="#f3f9f7" stroke="var(--aqua)" stroke-width="4" />
            <g class="node" onclick="openNode('pcf')">
                <text x="600" y="370" text-anchor="middle" font-weight="bold" fill="var(--aqua)" font-size="28">PCF</text>
                <text x="600" y="400" text-anchor="middle" font-weight="bold" fill="#5c6a72" font-size="12">Policy Control Function</text>
                <line x1="530" y1="420" x2="670" y2="420" stroke="var(--aqua)" stroke-opacity="0.3" />
                <text x="600" y="450" text-anchor="middle" fill="#5c6a72" font-size="9" font-weight="bold">QoS Decision • Charging Control</text>
                <text x="600" y="470" text-anchor="middle" fill="#5c6a72" font-size="9" font-weight="bold">Session & Mobility Rules</text>
            </g>

            <!-- CONSUMERS (SBI) -->
            <g class="node" onclick="openNode('smf')">
                <rect x="30" y="200" width="150" height="90" rx="15" fill="white" stroke="var(--blue)" stroke-width="2" />
                <text x="105" y="240" text-anchor="middle" font-weight="bold" fill="#5c6a72" font-size="16">SMF</text>
                <text x="105" y="260" text-anchor="middle" fill="#5c6a72" font-size="10">N7 (Session Policy)</text>
            </g>

            <g class="node" onclick="openNode('amf')">
                <rect x="30" y="380" width="150" height="90" rx="15" fill="white" stroke="var(--green)" stroke-width="2" />
                <text x="105" y="420" text-anchor="middle" font-weight="bold" fill="#5c6a72" font-size="16">AMF</text>
                <text x="105" y="440" text-anchor="middle" fill="#5c6a72" font-size="10">N15 (Mobility Policy)</text>
            </g>

            <g class="node" onclick="openNode('af')">
                <rect x="30" y="560" width="150" height="90" rx="15" fill="white" stroke="var(--purple)" stroke-width="2" />
                <text x="105" y="600" text-anchor="middle" font-weight="bold" fill="#5c6a72" font-size="16">AF</text>
                <text x="105" y="620" text-anchor="middle" fill="#5c6a72" font-size="10">N5 (App Influence)</text>
            </g>

            <!-- DATA SOURCES -->
            <g class="node" onclick="openNode('udr')">
                <rect x="980" y="365" width="180" height="120" rx="15" fill="#fdf5ea" stroke="var(--orange)" stroke-width="3" />
                <text x="1070" y="410" text-anchor="middle" font-weight="bold" fill="#5c6a72" font-size="18">UDR</text>
                <text x="1070" y="435" text-anchor="middle" fill="#5c6a72" font-size="11">Policy/Sub Data Repository</text>
                <text x="1070" y="460" text-anchor="middle" fill="var(--orange)" font-size="9" font-weight="bold">Service Interface: Nudr</text>
            </g>

            <g class="node" onclick="openNode('chf')">
                <rect x="500" y="700" width="200" height="100" rx="15" fill="#fdebeb" stroke="var(--red)" stroke-width="2" />
                <text x="600" y="740" text-anchor="middle" font-weight="bold" fill="#5c6a72" font-size="18">CHF</text>
                <text x="600" y="765" text-anchor="middle" fill="#5c6a72" font-size="11">Spending Limit Control</text>
                <text x="600" y="785" text-anchor="middle" fill="var(--red)" font-size="9" font-weight="bold">Interface: N28</text>
            </g>

            <!-- Interface Labels -->
            <text x="350" y="325" fill="var(--blue)" font-weight="bold" font-size="12" text-anchor="middle">Npcf_SMPolicyControl</text>
            <text x="350" y="415" fill="var(--green)" font-weight="bold" font-size="12" text-anchor="middle">Npcf_AMPolicyControl</text>
            <text x="350" y="525" fill="var(--purple)" font-weight="bold" font-size="12" text-anchor="middle">Npcf_PolicyAuthorization</text>
            <text x="840" y="415" fill="var(--orange)" font-weight="bold" font-size="12" text-anchor="middle">Nudr_PolicyData</text>

            <!-- Animation Particles -->
            <circle id="p-blue" class="particle" r="8" fill="var(--blue)" />
            <circle id="p-green" class="particle" r="8" fill="var(--green)" />
            <circle id="p-purple" class="particle" r="8" fill="var(--purple)" />
            <circle id="p-orange" class="particle" r="9" fill="var(--orange)" />
            <circle id="p-red" class="particle" r="7" fill="var(--red)" />
        </svg>

        <div class="signature">Vinayak Majhi</div>
    </main>

    <!-- Side Panel -->
    <div id="side-panel">
        <div class="close-btn" onclick="closeNode()">✕</div>
        <div class="panel-header">
            <span id="p-tag" class="panel-tag">Network Function</span>
            <h2 id="p-title" class="panel-title">Component Name</h2>
        </div>
        <div id="p-body" class="panel-content">
            Detailed technical description will load here based on 3GPP standards.
        </div>
    </div>

    <script>
        gsap.registerPlugin(MotionPathPlugin);

        const pcfData = {
            pcf: {
                title: "Policy Control Function (PCF)",
                tag: "CORE POLICY BRAIN",
                body: "The Policy Control Function (PCF) is the central 5G Network Function (NF) responsible for policy and charging control decisions, as defined in 3GPP TS 23.501 and TS 23.503. It governs the session-level behaviors of the SMF and mobility behaviors of the AMF. The PCF synthesizes diverse inputs—including subscriber profile data from the UDR, application influence requests from AFs (N5), and real-time spending limits from the CHF (N28)—to generate a coherent set of Policy and Charging Control (PCC) rules. It ensures that service quality, prioritization, and bandwidth allocation meet the operator's business requirements while respecting user subscription limits across all slices and data networks."
            },
            smf: {
                title: "Session Management (SMF)",
                tag: "N7 POLICY CONSUMER",
                body: "The SMF interacts with the PCF via the N7 interface (using the Npcf_SMPolicyControl service) to manage the lifecycle of PDU sessions. When a PDU session is established or modified, the SMF requests PCC rules from the PCF. These rules include QoS parameters (bit rates, latency targets) and charging requirements. The PCF may also proactively update the SMF if a subscriber's policy change is triggered (e.g., they reach a data threshold or an application requires low-latency resources). This interaction is the fundamental mechanism for per-session data prioritization and monetization in the 5G system."
            },
            amf: {
                title: "Access & Mobility Mgmt (AMF)",
                tag: "N15 POLICY CONSUMER",
                body: "The AMF consumes PCF services via the N15 interface (using the Npcf_AMPolicyControl service) to obtain Access and Mobility policies. Unlike session policies, these rules govern the physical presence and behavior of the UE. This includes Tracking Area (TA) restrictions (where the user is allowed to move), roaming limitations, and Network Slice selection policies. By querying the PCF, the AMF can ensure that a device only attaches to authorized network segments and remains within its permitted geographic boundaries, providing the operator with top-down control over the user's mobility footprint."
            },
            af: {
                title: "Application Function (AF)",
                tag: "N5 APP INFLUENCE",
                body: "The Application Function (AF) is an external or internal entity that influences policy decisions via the N5 interface (using Npcf_PolicyAuthorization). This is a hallmark of 5G flexibility: an application (like a cloud gaming server or a VoIP bridge) can notify the PCF about its specific QoS requirements. For example, a 4K video stream might request a high-bandwidth GBR (Guaranteed Bit Rate) bearer. The PCF evaluates this application-level request against the user's subscription and pushes a dynamic policy update to the SMF to 'unlock' the required network performance for that specific session."
            },
            udr: {
                title: "Unified Data Repository (UDR)",
                tag: "Nudr DATA SOURCE",
                body: "The UDR acts as the backend database for the PCF, storing permanent policy data and subscriber profile information. The PCF uses the Nudr interface to retrieve 'Policy Data' that dictates the baseline behavior for a specific user group or slice. This separation of logic (PCF) and state (UDR) allows the PCF to remain stateless and highly scalable. Every time a policy decision is required, the PCF can query the UDR to ensure it has the most current profile, including any background changes made by the billing or customer management systems."
            },
            chf: {
                title: "Charging Function (CHF)",
                tag: "N28 SPENDING CONTROL",
                body: "The interaction between PCF and CHF over the N28 interface is focused on 'Spending Limit Monitoring'. If an operator offers a plan where the Quality of Service (QoS) changes after a user consumes a certain amount of data (e.g., 'Fair Usage Policy'), the CHF monitors this consumption. When a limit is reached, the CHF notifies the PCF via N28. The PCF then evaluates the impact and may push a new, throttled policy to the SMF. This ensures a closed loop between the financial accounting (CHF) and the network enforcement (PCF), preventing revenue leakage while managing network capacity."
            }
        };

        function openNode(key) {
            const data = pcfData[key];
            if(!data) return;
            document.getElementById('p-title').innerText = data.title;
            document.getElementById('p-tag').innerText = data.tag;
            document.getElementById('p-body').innerText = data.body;
            document.getElementById('side-panel').classList.add('active');
            gsap.to('.node', { opacity: 0.3, duration: 0.4 });
        }

        function closeNode() {
            document.getElementById('side-panel').classList.remove('active');
            gsap.to('.node', { opacity: 1, duration: 0.4 });
        }

        // --- Animation Engine ---
        let tl = gsap.timeline();

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            gsap.to(t, { opacity: 1, y: -20, duration: 0.3 });
            setTimeout(() => gsap.to(t, { opacity: 0, duration: 0.3 }), 3000);
        }

        function resetPCF() {
            tl.kill();
            gsap.set(".particle", { visibility: "hidden", x: 0, y: 0, opacity: 1 });
            showToast("Policy State Synchronized.");
        }

        function animatePCF(type) {
            resetPCF();
            tl = gsap.timeline();

            if (type === 'pcc') {
                showToast("N7: SMF requesting PCC rules for new PDU session...");
                tl.to("#p-blue", { visibility: "visible", x: 105, y: 240, duration: 0 })
                  .to("#p-blue", { motionPath: { path: "#path-n7", align: "#path-n7", alignOrigin: [0.5, 0.5] }, duration: 1.5, start: 0, end: 1 })
                  .call(() => showToast("PCF: Retrieving Subscriber Policy Data from UDR..."))
                  .to("#p-orange", { visibility: "visible", x: 600, y: 425, duration: 0 })
                  .to("#p-orange", { motionPath: { path: "#path-nudr", align: "#path-nudr", alignOrigin: [0.5, 0.5] }, duration: 1.2 })
                  .call(() => showToast("Decision Made: Returning PCC rules (QoS/Charging) to SMF."))
                  .to("#p-blue", { motionPath: { path: "#path-n7", align: "#path-n7", alignOrigin: [0.5, 0.5] }, duration: 1.2, start: 1, end: 0 });
            } 
            else if (type === 'mobility') {
                showToast("N15: AMF retrieving Mobility Restrictions...");
                tl.to("#p-green", { visibility: "visible", x: 105, y: 420, duration: 0 })
                  .to("#p-green", { motionPath: { path: "#path-n15", align: "#path-n15", alignOrigin: [0.5, 0.5] }, duration: 1.5 })
                  .call(() => showToast("PCF: Returning Access Policies to AMF..."))
                  .to("#p-green", { motionPath: { path: "#path-n15", align: "#path-n15", alignOrigin: [0.5, 0.5] }, duration: 1.2, start: 1, end: 0 });
            }
            else if (type === 'influence') {
                showToast("N5: AF requesting Low-Latency for App Session...");
                tl.to("#p-purple", { visibility: "visible", x: 105, y: 600, duration: 0 })
                  .to("#p-purple", { motionPath: { path: "#path-n5", align: "#path-n5", alignOrigin: [0.5, 0.5] }, duration: 1.5 })
                  .call(() => showToast("PCF: Authorizing App Influence. Updating SMF Policy..."))
                  .to("#p-blue", { visibility: "visible", x: 600, y: 425, duration: 0 })
                  .to("#p-blue", { motionPath: { path: "#path-n7", align: "#path-n7", alignOrigin: [0.5, 0.5] }, duration: 1.2, start: 1, end: 0 });
            }
        }

        // Ambient pulse for PCF node
        gsap.to("rect[stroke='var(--aqua)']", {
            strokeWidth: 6,
            duration: 2,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut"
        });

    </script>
</body>
</html>